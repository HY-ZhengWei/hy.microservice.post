<?xml version="1.0" encoding="UTF-8"?>

<config>

    <import name="sqls"            class="java.util.ArrayList" />
    <import name="sqlGroup"        class="org.hy.common.xml.plugins.XSQLGroup" />
    <import name="sql"             class="org.hy.common.xml.XSQL" />



    <sqls>
    
        <sql id="XSQL_PostInfo_Insert"> 
        
            <dataSourceGroup ref="DSG_MS_Post" />
            
            <content>
                <![CDATA[
                INSERT  INTO PostInfo
                       (
                        id     
                       ,serviceType
                       ,deviceNo 
                       ,deviceType 
                       ,userID    
                       ,userName  
                       ,userIcon
                       ,userType
                       ,postTypeID
                       ,postTypeName
                       ,title
                       ,videoUrl      
                       ,videoUrlID
                       ,coverUrl      
                       ,coverUrlID
                       ,content
                       ,openCount
                       ,messageCount  
                       ,favoritesCount
                       ,goodCount 
                       ,isRecommend    
                       ,isShow        
                       ,createTime    
                       ,auditState    
                       ,auditResult   
                       ,auditTime     
                       )
                VALUES (
                        ':id'
                       ,':serviceType'
                       ,':deviceNo'
                       ,':deviceType'
                       ,':userID'
                       ,':userName'
                       ,':userIcon'
                       ,':userType'
                       ,':postTypeID'
                       ,':postTypeName'
                       ,':title'
                       ,':videoUrl'
                       ,':videoUrlID'
                       ,':coverUrl'
                       ,':coverUrlID'
                       ,':content'
                       ,':openCount'
                       ,':messageCount'
                       ,':favoritesCount'
                       ,':goodCount'
                       ,':isRecommend'
                       ,':isShow'
                       ,NOW()
                       ,':auditState'
                       ,':auditResult'
                       ,':auditTime'
                       )
                ]]>
            </content>
            
        </sql>
        
        
        
        <sql id="XSQL_PostInfo_Query"> 
        
            <dataSourceGroup ref="DSG_MS_Post" />
            
            <content>
                <![CDATA[
                SELECT  A.id     
                       ,A.serviceType
                       ,A.deviceNo 
                       ,A.deviceType 
                       ,A.userID    
                       ,A.userName  
                       ,A.userIcon
                       ,A.userType
                       ,A.postTypeID
                       ,A.postTypeName
                       ,A.title
                       ,A.videoUrl      
                       ,A.videoUrlID
                       ,A.coverUrl      
                       ,A.coverUrlID
                       ,A.content   
                       ,A.openCount    
                       ,(
                         SELECT  COUNT(1)
                           FROM  UserOpenLog  SC
                          WHERE  SC.userID      = ':userID'
                            AND  SC.openID      = A.id
                            AND  SC.serviceType = A.serviceType
                        )    AS  myIsOpen 
                       ,A.messageCount 
                       ,A.favoritesCount
                       ,(
                         SELECT  COUNT(1)
                           FROM  UserFavoritesLog  SB
                          WHERE  SB.userID      = ':userID'
                            AND  SB.favoritesID = A.id
                            AND  SB.serviceType = A.serviceType
                        )    AS  myIsFavorites 
                       ,A.goodCount  
                       ,(
                         SELECT  COUNT(1)
                           FROM  tbl_base_userNiceLog  SA
                          WHERE  SA.userID   = ':userID'
                            AND  SA.niceID   = A.id
                            AND  SA.niceType = A.serviceType
                        )    AS  myIsNice
                        ,(
                           SELECT  COUNT(1)
                               FROM  tbl_base_comment  SA
                           WHERE  SA.open_id    = ':userID'
                             AND  SA.post_id    = A.id
                             AND  SA.class_type = A.serviceType
                       )  AS  myIsComment
                       ,A.isRecommend        
                       ,A.isShow        
                       ,A.createTime    
                       ,A.auditState    
                       ,A.auditResult   
                       ,A.auditTime  
                  FROM  PostInfo  A
                 WHERE  A.auditState  = '1'
                   AND  A.isShow      = 1
                <[ AND  A.id          = ':id'           ]>
                <[ AND  A.userID      = ':userID'       ]>
                <[ AND  A.postTypeID  = ':postTypeID'   ]>
                   AND  A.serviceType = ':serviceType'
                 ORDER  BY A.createTime DESC
                          ,A.goodCount  DESC
                 <[ LIMIT :startIndex, :pagePerCount    ]>
                ]]>
            </content>
            
            <result>
                <row>org.hy.microservice.post.PostInfo</row>
                <cfill>setter(colValue)</cfill>
            </result>
            
        </sql>
        
        
        
        <sql id="XSQL_PostInfo_Query_Count"> 
        
            <dataSourceGroup ref="DSG_MS_Post" />
            
            <content>
                <![CDATA[
                SELECT  COUNT(1)  AS totalCount
                  FROM  PostInfo  A
                 WHERE  A.auditState  = '1'
                   AND  A.isShow      = 1
                <[ AND  A.id          = ':id'           ]>
                <[ AND  A.userID      = ':userID'       ]>
                <[ AND  A.postTypeID  = ':postTypeID'   ]>
                   AND  A.serviceType = ':serviceType'
                ]]>
            </content>
            
            <result>
                <row>org.hy.microservice.post.PostInfo</row>
                <cfill>setter(colValue)</cfill>
            </result>
            
        </sql>
        
        
        
        <sql id="XSQL_PostInfo_Update_GoodCount_Add"> 
        
            <dataSourceGroup ref="DSG_MS_Post" />
            
            <content>
                <![CDATA[
                UPDATE  PostInfo
                   SET  goodCount = goodCount + 1
                 WHERE  id        = ':id'
                ]]>
            </content>
            
        </sql>
        
        
        
        <sql id="XSQL_PostInfo_Update_GoodCount_Subtract"> 
        
            <dataSourceGroup ref="DSG_MS_Post" />
            
            <content>
                <![CDATA[
                UPDATE  PostInfo
                   SET  goodCount = goodCount - 1
                 WHERE  id        = ':id'
                ]]>
            </content>
            
        </sql>
        
        
        
        <sql id="XSQL_PostInfo_Update_FavoritesCount_Add"> 
        
            <dataSourceGroup ref="DSG_MS_Post" />
            
            <content>
                <![CDATA[
                UPDATE  PostInfo
                   SET  favoritesCount = favoritesCount + 1
                 WHERE  id             = ':id'
                ]]>
            </content>
            
        </sql>
        
        
        
        <sql id="XSQL_PostInfo_Update_FavoritesCount_Subtract"> 
        
            <dataSourceGroup ref="DSG_MS_Post" />
            
            <content>
                <![CDATA[
                UPDATE  PostInfo
                   SET  favoritesCount = favoritesCount - 1
                 WHERE  id             = ':id'
                ]]>
            </content>
            
        </sql>
        
        
        
        <sql id="XSQL_PostInfo_Update_MessageCount_Add"> 
        
            <dataSourceGroup ref="DSG_MS_Post" />
            
            <content>
                <![CDATA[
                UPDATE  PostInfo
                   SET  messageCount = messageCount + 1
                 WHERE  id           = ':id'
                ]]>
            </content>
            
        </sql>
        
        
        
        <sql id="XSQL_PostInfo_Update_OpenCount_Add"> 
        
            <dataSourceGroup ref="DSG_MS_Post" />
            
            <content>
                <![CDATA[
                UPDATE  PostInfo
                   SET  openCount = openCount + 1
                 WHERE  id        = ':id'
                ]]>
            </content>
            
        </sql>
        
        
        
        <sql id="XSQL_PostInfo_Update_PostByID">

            <dataSourceGroup ref="DSG_MS_Post" />

            <content>
                <![CDATA[
                UPDATE  PostInfo
                   SET  id                = ':id'
                        <[ ,postTypeName  = ':postTypeName' ]>
                        <[ ,postTypeID    = ':postTypeID'   ]>
                        <[ ,title         = ':title'        ]>
                        <[ ,videoUrl      = ':videoUrl'     ]>
                        <[ ,videoUrlID    = ':videoUrlID'   ]>
                        <[ ,coverUrl      = ':coverUrl'     ]>
                        <[ ,content       = ':content'      ]>
                           ,updateTime    = NOW()
                 WHERE  id                = ':id'
                ]]>
            </content>

        </sql>

    </sqls>
    
</config>